<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ©ã‚¤ãƒ³å¤–ä½œæ¥­ã‚¿ã‚¤ãƒãƒ¼è¨˜éŒ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent: #2563eb;
      --accent-soft: #e5f0ff;
      --danger: #e11d48;
      --bg: #f5f5f7;
      --card: #ffffff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --border-soft: #e5e7eb;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-soft: 0 4px 12px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top, #e0edff 0, #f5f5f7 45%, #f5f5f7 100%);
      color: var(--text-main);
    }

    .app {
      max-width: 520px;
      margin: 0 auto;
      padding: 16px 16px 32px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
      padding: 4px 2px;
    }

    h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .badge {
      font-size: 11px;
      color: var(--text-sub);
      background: rgba(37, 99, 235, 0.08);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(37, 99, 235, 0.15);
      margin-left: 6px;
    }

    .icon-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(255, 255, 255, 0.9);
      padding: 6px 12px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-sub);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.08);
      cursor: pointer;
    }

    .icon-btn span {
      font-size: 14px;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    /* ã‚¿ã‚¹ã‚¯ãƒœã‚¿ãƒ³ */
    .task-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .task-btn {
      flex: 1 1 calc(50% - 8px);
      min-width: calc(50% - 8px);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      background: rgba(255, 255, 255, 0.85);
      padding: 12px 10px;
      font-size: 14px;
      text-align: center;
      line-height: 1.3;
      color: var(--text-main);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.04);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 52px;
      transition: all 0.15s ease-out;
      word-break: keep-all;
    }

    .task-btn.selected {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: white;
      border-color: rgba(37, 99, 235, 0.4);
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    .task-btn.editing {
      outline: 2px dashed rgba(234, 179, 8, 0.9);
      outline-offset: 2px;
    }

    .task-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
      font-size: 11px;
    }

    .link-btn {
      border: none;
      background: none;
      padding: 0;
      font-size: 11px;
      color: var(--accent);
      text-decoration: underline;
      cursor: pointer;
    }

    /* å…¥åŠ›ãƒ»ãƒœã‚¿ãƒ³é¡ */
    label {
      font-size: 12px;
      margin-bottom: 4px;
      display: block;
      color: var(--text-sub);
    }

    input[type="text"] {
      width: 100%;
      font-size: 14px;
      padding: 10px 11px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      outline: none;
      background: rgba(249, 250, 251, 0.9);
    }

    input[type="text"]:focus {
      border-color: rgba(37, 99, 235, 0.65);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
      background: #ffffff;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 12px 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15);
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ffffff;
    }

    .btn-danger {
      background: linear-gradient(135deg, #f97373, #ef4444);
      color: #ffffff;
    }

    .btn:disabled {
      opacity: 0.4;
      box-shadow: none;
      cursor: default;
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #9ca3af;
    }

    .status-dot.running {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
    }

    /* ãƒ­ã‚° */
    textarea {
      width: 100%;
      min-height: 150px;
      font-size: 13px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #f9fafb;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      gap: 8px;
    }

    .copy-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      font-size: 11px;
      padding: 4px 10px;
      background: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .message {
      margin-top: 6px;
      font-size: 12px;
      color: var(--text-sub);
      min-height: 1.2em;
    }

    @media (max-width: 360px) {
      .task-btn {
        font-size: 13px;
        min-height: 48px;
      }
      .btn {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-bar">
      <div>
        <h1>ãƒ©ã‚¤ãƒ³å¤–ä½œæ¥­ã‚¿ã‚¤ãƒãƒ¼</h1>
        <div class="card-sub">ã‚¹ãƒãƒ›1å°ã§ã€Œè¦ç´ åˆ¥ã‚¿ã‚¤ãƒ ï¼†Excelè²¼ã‚Šä»˜ã‘ã€</div>
      </div>
      <button id="editToggle" class="icon-btn" type="button">
        <span>âœï¸</span> è¦ç´ åç·¨é›†
      </button>
    </div>

    <!-- è¦ç´ ä½œæ¥­ãƒœã‚¿ãƒ³ -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">
          è¦ç´ ä½œæ¥­
          <span class="badge">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é¸æŠ</span>
        </div>
      </div>
      <div id="taskButtons" class="task-grid"></div>
      <div class="task-footer">
        <button id="addTaskBtn" class="link-btn" type="button">ï¼‹ è¦ç´ è¿½åŠ </button>
        <button id="resetTaskBtn" class="link-btn" type="button">åˆæœŸã«æˆ»ã™</button>
      </div>
    </section>

    <!-- ä½œæ¥­è€… & æ“ä½œ -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">è¨ˆæ¸¬æ“ä½œ</div>
      </div>

      <label for="operator">ä½œæ¥­è€…åï¼ˆä»»æ„ï¼‰</label>
      <input id="operator" type="text" placeholder="ä¾‹ï¼‰Aã•ã‚“" />

      <div class="row">
        <button id="startBtn" class="btn btn-primary" type="button" disabled>
          â–¶ STARTï¼ˆè¨ˆæ¸¬é–‹å§‹ï¼‰
        </button>
        <button id="stopBtn" class="btn btn-danger" type="button" disabled>
          â–  STOP ï¼† è¨˜éŒ²
        </button>
      </div>

      <div class="status">
        <div id="statusDot" class="status-dot"></div>
        <div id="statusText">å¾…æ©Ÿä¸­ï¼šè¦ç´ ãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ã€ŒSTARTã€ã—ã¦ãã ã•ã„ã€‚</div>
      </div>
    </section>

    <!-- ãƒ­ã‚° -->
    <section class="card">
      <div class="log-header">
        <div class="card-title">è¨˜éŒ²ï¼ˆã“ã®ã¾ã¾Excelã«è²¼ã‚Šä»˜ã‘å¯ï¼‰</div>
        <button id="copyBtn" class="copy-btn" type="button">ğŸ“‹ å…¨ã‚³ãƒ”ãƒ¼</button>
      </div>
      <textarea id="log" spellcheck="false"></textarea>
      <div id="message" class="message"></div>
    </section>
  </div>

  <script>
    // ===== è¨­å®š =====
    const DEFAULT_TASKS = [
      "éƒ¨å“é‹æ¬",
      "å“ç•ªç¢ºèª",
      "æ£šç•ªæ¤œç´¢",
      "ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆå¾…ã¡",
      "è£½å“ä»®ç½®ã",
      "æ‰‹ç›´ã—ä½œæ¥­",
      "ç¤¾å“¡å‘¼ã³å‡ºã—"
    ];

    const STORAGE_KEY_TASKS = "lineTimerTasks_v1";

    // ===== çŠ¶æ…‹å¤‰æ•° =====
    let tasks = [];
    let selectedTaskIndex = null;
    let isRunning = false;
    let startTime = null;
    let editMode = false;

    // ===== DOMå–å¾— =====
    const taskButtonsEl = document.getElementById("taskButtons");
    const editToggleBtn = document.getElementById("editToggle");
    const addTaskBtn = document.getElementById("addTaskBtn");
    const resetTaskBtn = document.getElementById("resetTaskBtn");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const operatorInput = document.getElementById("operator");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const logArea = document.getElementById("log");
    const copyBtn = document.getElementById("copyBtn");
    const messageEl = document.getElementById("message");

    // ===== åˆæœŸåŒ– =====
    function loadTasks() {
      const saved = localStorage.getItem(STORAGE_KEY_TASKS);
      if (saved) {
        try {
          const arr = JSON.parse(saved);
          if (Array.isArray(arr) && arr.length > 0) {
            tasks = arr;
            return;
          }
        } catch (e) {
          console.warn("ã‚¿ã‚¹ã‚¯æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆæœŸå€¤ã‚’ä½¿ã„ã¾ã™ã€‚");
        }
      }
      tasks = [...DEFAULT_TASKS];
    }

    function saveTasks() {
      localStorage.setItem(STORAGE_KEY_TASKS, JSON.stringify(tasks));
    }

    function renderTaskButtons() {
      taskButtonsEl.innerHTML = "";
      tasks.forEach((name, index) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "task-btn";
        if (index === selectedTaskIndex) {
          btn.classList.add("selected");
        }
        if (editMode) {
          btn.classList.add("editing");
        }
        btn.textContent = name;
        btn.addEventListener("click", () => {
          if (editMode) {
            const newName = prompt("è¦ç´ åã‚’ç·¨é›†", tasks[index]);
            if (newName && newName.trim() !== "") {
              tasks[index] = newName.trim();
              saveTasks();
              renderTaskButtons();
            }
            return;
          }
          // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šè¦ç´ é¸æŠ
          selectedTaskIndex = index;
          renderTaskButtons();
          updateButtonsState();
          setStatus(
            `é¸æŠä¸­ï¼šã€Œ${tasks[index]}ã€ / STARTã§è¨ˆæ¸¬é–‹å§‹`,
            false
          );
        });
        taskButtonsEl.appendChild(btn);
      });
    }

    function ensureLogHeader() {
      if (!logArea.value.trim()) {
        logArea.value = "è¦ç´ ä½œæ¥­,é–‹å§‹æ™‚åˆ»,çµ‚äº†æ™‚åˆ»,è¨ˆæ¸¬ç§’,è¨ˆæ¸¬æ—¥,ä½œæ¥­è€…\n";
      } else if (!/^è¦ç´ ä½œæ¥­,é–‹å§‹æ™‚åˆ»,çµ‚äº†æ™‚åˆ»,è¨ˆæ¸¬ç§’,è¨ˆæ¸¬æ—¥,ä½œæ¥­è€…/.test(logArea.value)) {
        // æ—¢å­˜ãƒ˜ãƒƒãƒ€ãŒåˆ¥å½¢å¼ãªã‚‰å¿µã®ãŸã‚ä¸Šæ›¸ã
        logArea.value = "è¦ç´ ä½œæ¥­,é–‹å§‹æ™‚åˆ»,çµ‚äº†æ™‚åˆ»,è¨ˆæ¸¬ç§’,è¨ˆæ¸¬æ—¥,ä½œæ¥­è€…\n" + logArea.value.trim() + "\n";
      }
    }

    function formatDateTime(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      const ss = String(d.getSeconds()).padStart(2, "0");
      return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;
    }

    function formatDate(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function setStatus(text, running) {
      statusText.textContent = text;
      if (running) {
        statusDot.classList.add("running");
      } else {
        statusDot.classList.remove("running");
      }
    }

    function updateButtonsState() {
      // STARTã¯ã€Œè¦ç´ é¸æŠæ¸ˆã¿ï¼†æœªè¨ˆæ¸¬ä¸­ã€ã§æœ‰åŠ¹
      startBtn.disabled = selectedTaskIndex == null || isRunning;
      // STOPï¼†è¨˜éŒ²ã¯ã€Œè¨ˆæ¸¬ä¸­ã€ã®ã¿æœ‰åŠ¹
      stopBtn.disabled = !isRunning;
    }

    // ===== ã‚¤ãƒ™ãƒ³ãƒˆ =====
    editToggleBtn.addEventListener("click", () => {
      editMode = !editMode;
      editToggleBtn.textContent = editMode ? "ç·¨é›†çµ‚äº†" : "è¦ç´ åç·¨é›†";
      renderTaskButtons();
      setStatus(
        editMode
          ? "ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šå¤‰æ›´ã—ãŸã„ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚"
          : "å¾…æ©Ÿä¸­ï¼šè¦ç´ ãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ã€ŒSTARTã€ã—ã¦ãã ã•ã„ã€‚",
        false
      );
    });

    addTaskBtn.addEventListener("click", () => {
      const name = prompt("è¿½åŠ ã™ã‚‹è¦ç´ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      if (name && name.trim() !== "") {
        tasks.push(name.trim());
        saveTasks();
        renderTaskButtons();
      }
    });

    resetTaskBtn.addEventListener("click", () => {
      if (confirm("è¦ç´ åã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ")) {
        tasks = [...DEFAULT_TASKS];
        saveTasks();
        selectedTaskIndex = null;
        renderTaskButtons();
        setStatus("å¾…æ©Ÿä¸­ï¼šè¦ç´ ãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ã€ŒSTARTã€ã—ã¦ãã ã•ã„ã€‚", false);
        updateButtonsState();
      }
    });

    startBtn.addEventListener("click", () => {
      if (selectedTaskIndex == null) {
        alert("å…ˆã«è¦ç´ ä½œæ¥­ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      startTime = new Date();
      isRunning = true;
      updateButtonsState();
      const taskName = tasks[selectedTaskIndex];
      setStatus(`è¨ˆæ¸¬ä¸­ï¼šã€Œ${taskName}ã€`, true);
      messageEl.textContent = "";
    });

    stopBtn.addEventListener("click", () => {
      if (!isRunning || !startTime) return;
      const endTime = new Date();
      const diffSec = Math.round((endTime - startTime) / 1000);
      const taskName = tasks[selectedTaskIndex] || "";
      const operator = operatorInput.value.trim();

      ensureLogHeader();
      const row = [
        taskName,
        formatDateTime(startTime),
        formatDateTime(endTime),
        diffSec,
        formatDate(endTime),
        operator
      ].join(",");

      logArea.value += row + "\n";

      messageEl.textContent = `è¨˜éŒ²ã—ã¾ã—ãŸï¼š${taskName}, ${diffSec}ç§’`;
      setStatus("å¾…æ©Ÿä¸­ï¼šæ¬¡ã®è¨ˆæ¸¬ã‚’é–‹å§‹ã§ãã¾ã™ã€‚", false);

      isRunning = false;
      startTime = null;
      updateButtonsState();
    });

    copyBtn.addEventListener("click", async () => {
      const text = logArea.value;
      if (!text.trim()) {
        alert("ã‚³ãƒ”ãƒ¼ã™ã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          logArea.focus();
          logArea.select();
          document.execCommand("copy");
        }
        messageEl.textContent = "ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚Excelã«è²¼ã‚Šä»˜ã‘ã§ãã¾ã™ã€‚";
      } catch (e) {
        alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ç¯„å›²é¸æŠ â†’ ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
      }
    });

    // ===== å®Ÿè¡Œ =====
    loadTasks();
    renderTaskButtons();
    updateButtonsState();
    setStatus("å¾…æ©Ÿä¸­ï¼šè¦ç´ ãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ã€ŒSTARTã€ã—ã¦ãã ã•ã„ã€‚", false);
  </script>
</body>
</html>
